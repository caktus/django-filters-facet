# ----------------------------------------------------------------------------
# Global: Common configuration variables for all environments being deployed
#         to Kubernetes.
# ----------------------------------------------------------------------------

app_name: dff
ansible_connection: local
ansible_python_interpreter: '/usr/bin/env python3'

aws_region: us-east-1
aws_profile: saguaro-cluster

# ----------------------------------------------------------------------------
# caktus.django-k8s: Shared configuration variables for staging and production
#                    environments.
# ----------------------------------------------------------------------------

k8s_auth_host: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  35356663373735656364376530363339623431626363663265616631636232346165643362323163
  3330663162666436373037356166313436316266333530640a313064613333306139393466633231
  34393434383830643431616564333630323039383230363964643939633737386261663032343934
  6130393134383366650a366463653637353662356530306539303036656232643061313037323531
  64333438333230656236366462333034623137306431313630666364616363616535326135363165
  37396132326537313862373937393339393232323961333430636166626431666163306665306664
  39643266356131373436363362313838646532303765396233316563353439313930326561666632
  34653934633239376133
k8s_auth_ssl_ca_cert: k8s_auth_ssl_ca_cert.txt
k8s_cluster_name: caktus-saguaro-cluster

# App base configuration:
django_app_name: example_project
k8s_namespace: "{{ app_name }}-{{ env_name }}"
k8s_ingress_certificate_issuer: letsencrypt-production

# App pod configuration:
k8s_container_name: app
k8s_container_port: 8000
k8s_container_image: 472354598015.dkr.ecr.us-east-1.amazonaws.com/django-filters-facet
k8s_container_image_pull_policy: Always
k8s_container_replicas: 2
k8s_container_resources:
  requests:
    memory: 256Mi
    cpu: 50m
  limits:
    cpu: 250m
k8s_container_ingress_annotations:
  nginx.ingress.kubernetes.io/proxy-body-size: 100m
  # These are in seconds, but need to be specified without the trailing 's'
  # usually seen in nginx.conf proper.
  nginx.ingress.kubernetes.io/proxy-connect-timeout: 1800
  nginx.ingress.kubernetes.io/proxy-send-timeout: 1800
  nginx.ingress.kubernetes.io/proxy-read-timeout: 1800
  # Workaround for lack of annotation for send_timeout parameter:
  # https://github.com/kubernetes/ingress-nginx/issues/2441#issuecomment-419714384
  nginx.ingress.kubernetes.io/configuration-snippet: |
    send_timeout 1800s;
k8s_migrations_enabled: true
k8s_collectstatic_enabled: false

# Shared environment variables:
env_django_debug: false
database_address: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  37653361653161383762636162343666306263366439366139373338323631333362303138656138
  3339356131623564363635386238303836646138356135650a653732393430353662333333643465
  62386532633534343838633862333434363930613364323865643436363633663532383231306330
  6534353266383436610a326635383532313731333930646137323434633939363965363237663665
  37616139306337386136366436326436646638333237346261653939373062643134306161313838
  30613531653530653431383637363338306532353336663933343335623965653766646430626230
  38393032663235633834633237366663663831316266353163343033333735343165323165323637
  62373365633037663731636630646465366562656434643236306566383538653262663561383739
  3532
env_database_url: "postgres://{{ app_name }}_{{ env_name }}:{{ database_password }}@{{ database_address }}:5432/{{ app_name }}_{{ env_name }}"
env_django_settings: "{{ django_app_name }}.settings"
# Email: ses-django-filters-facet.20220815-083011
env_email_host: email-smtp.us-east-1.amazonaws.com
env_email_use_tls: "true"
env_email_host_user: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  30393637353831643035313864363965386432313539383338653765633936633662303861643036
  3537656537376339343238313036623566643237316433640a623232333963616330626131393662
  32633434633935636264306632303833303562303963373366343461336532356563346537636132
  3566386239383132310a356135393961323063356664353637383462373165626437393363393937
  62373263376637313832396265613133613732363166313337383332646536356261
env_email_host_pass: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  30623130646437343831646630663035373932326330376161356233613339353530633539616339
  3330626135616235383033313435643664393030663466640a616539613931386436393862656161
  36343334636531396534663066393835363564326165613930373830326263333637653538613133
  3765343061633762360a393962313230663538326461383638373465643662396439663233653739
  63333839393838396238623965373332306365383661663530386437376262333766323638356561
  6239346364333535633136306132663332376235376136666463
# Sentry
env_sentry_dsn: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  39653165353166323464616337343931386133366566336335383464313232366136636231643634
  3636356266353130643231306366623861303532316335380a356534643939653561396130656665
  38353535623531356662343061356463343630373165336266666236613363396134353161313433
  3435383430653331630a333934346335366239666235336464393162383830616633306531643531
  39333163353463353465646130626231306430316166383133613438653936356465303066323962
  36373937353132376237323564666562313338303864623433343963353263306464326661316462
  37616339373563346333613938373231336236306531333863333465363433386534396639363932
  64623132623631326463

# Environment variables:
k8s_environment_variables:
  CONTAINER_IMAGE_TAG: "{{ k8s_container_image_tag }}"
  DJANGO_DEBUG: "{{ env_django_debug | string | title | string }}"
  DATABASE_URL: "{{ env_database_url }}"
  DJANGO_SETTINGS_MODULE: "{{ env_django_settings }}"
  DJANGO_SECRET_KEY: "{{ env_django_secret_key }}"
  # DOMAIN is the ALLOWED_HOST
  DOMAIN: "{{ k8s_domain_names[0] }}"
  ALLOWED_HOSTS: "{{ k8s_domain_names[0] }}"
  ENVIRONMENT: "{{ env_name }}"
  # Email
  EMAIL_HOST: "{{ env_email_host }}"
  EMAIL_HOST_USER: "{{ env_email_host_user }}"
  EMAIL_HOST_PASSWORD: "{{ env_email_host_pass }}"
  EMAIL_USE_TLS: "{{ env_email_use_tls }}"
  # Sentry
  SENTRY_DSN: "{{ env_sentry_dsn }}"
